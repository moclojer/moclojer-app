spec:
  name: moclojer-app
  region: nyc
  
  alerts:
  - rule: DEPLOYMENT_FAILED
  - rule: DOMAIN_FAILED
  
  databases:
  - engine: PG
    name: moclojer-db
    version: "12"
  
  features:
  - buildpack-stack=ubuntu-22
  
  domains:
  - domain: app.moclojer.com
    type: PRIMARY
  
  ingress:
    rules:
    - component:
        name: moclojer-front
      match:
        path:
          prefix: /
    - component:
        name: moclojer-api
      match:
        path:
          prefix: /api
  
  services:
  - name: moclojer-front
    dockerfile_path: docker/Dockerfile.front
    http_port: 8000
    instance_count: 1
    instance_size_slug: professional-xs
    source_dir: /
    github:
      branch: main
      deploy_on_push: true
      repo: moclojer/moclojer-app
    envs:
    - key: API_URL
      scope: RUN_TIME
      value: https://
  
  - name: moclojer-api
    dockerfile_path: docker/Dockerfile.api
    http_port: 3000
    instance_count: 1
    instance_size_slug: professional-xs
    source_dir: /
    github:
      branch: main
      deploy_on_push: true
      repo: moclojer/moclojer-app
    envs:
    - key: DATABASE_URL 
      scope: RUN_TIME
      value: ${moclojer-db.DATABASE_URL}
    - key: AWS_ACCESS_KEY_ID
      scope: RUN_TIME
      value: "foo"
    - key: AWS_SECRET_ACCESS_KEY
      scope: RUN_TIME
      value: "bar"
    - key: REDIS_URL
      scope: RUN_TIME
      value: ${moclojer-db.REDIS_URL}
    - key: PROFILE
      scope: RUN_TIME
      value: "prod"
  
  workers:
  - name: moclojer-yaml-generator
    dockerfile_path: docker/Dockerfile.yaml-generator
    instance_count: 1
    instance_size_slug: professional-xs
    source_dir: /
    github:
      branch: main
      deploy_on_push: true
      repo: moclojer/moclojer-app
    envs:
    - key: DATABASE_URL
      scope: RUN_TIME
      value: ${moclojer-db.DATABASE_URL}
    - key: AWS_ACCESS_KEY_ID
      scope: RUN_TIME
      value: "foo"
    - key: AWS_SECRET_ACCESS_KEY
      scope: RUN_TIME
      value: "bar"
    - key: REDIS_URL
      scope: RUN_TIME
      value: ${moclojer-db.REDIS_URL}
    - key: PROFILE
      scope: RUN_TIME
      value: "prod"
