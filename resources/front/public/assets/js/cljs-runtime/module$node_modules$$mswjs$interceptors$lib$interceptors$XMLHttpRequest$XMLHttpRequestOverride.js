shadow$provide.module$node_modules$$mswjs$interceptors$lib$interceptors$XMLHttpRequest$XMLHttpRequestOverride=function(global,require,module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=
0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=0<t.length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3]))_.label=op[1];else if(6===op[0]&&_.label<t[1])_.label=t[1],t=op;else if(t&&_.label<t[2])_.label=t[2],_.ops.push(op);else{t[2]&&_.ops.pop();_.trys.pop();continue}}op=body.call(thisArg,
_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},"function"===typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g},__values=this&&this.__values||function(o){var s="function"===typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"===typeof o.length)return{next:function(){o&&
i>=o.length&&(o=void 0);return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.");},__read=this&&this.__read||function(o,n){var m="function"===typeof Symbol&&o[Symbol.iterator];if(!m)return o;o=m.call(o);var r,ar=[];try{for(;(void 0===n||0<n--)&&!(r=o.next()).done;)ar.push(r.value)}catch(error){var e={error}}finally{try{r&&!r.done&&(m=o["return"])&&m.call(o)}finally{if(e)throw e.error;}}return ar};Object.defineProperty(exports,"__esModule",
{value:!0});exports.createXMLHttpRequestOverride=void 0;var until_1=require("module$node_modules$$open_draft$until$lib$index"),headers_polyfill_1=require("module$node_modules$headers_polyfill$lib$index"),xmldom_1=require("module$node_modules$$xmldom$xmldom$lib$index"),parseJson_1=require("module$node_modules$$mswjs$interceptors$lib$utils$parseJson"),toIsoResponse_1=require("module$node_modules$$mswjs$interceptors$lib$utils$toIsoResponse"),bufferFrom_1=require("module$node_modules$$mswjs$interceptors$lib$interceptors$XMLHttpRequest$utils$bufferFrom"),
createEvent_1=require("module$node_modules$$mswjs$interceptors$lib$interceptors$XMLHttpRequest$utils$createEvent"),IsomorphicRequest_1=require("module$node_modules$$mswjs$interceptors$lib$IsomorphicRequest"),bufferUtils_1=require("module$node_modules$$mswjs$interceptors$lib$utils$bufferUtils"),InteractiveIsomorphicRequest_1=require("module$node_modules$$mswjs$interceptors$lib$InteractiveIsomorphicRequest");exports.createXMLHttpRequestOverride=function(options$jscomp$0){var _a$jscomp$1,XMLHttpRequest=
options$jscomp$0.XMLHttpRequest,emitter=options$jscomp$0.emitter,log=options$jscomp$0.log;return _a$jscomp$1=function(){function XMLHttpRequestOverride(){this._events=[];this.log=log;this.UNSENT=0;this.OPENED=1;this.HEADERS_RECEIVED=2;this.LOADING=3;this.DONE=4;this.ontimeout=this.onprogress=this.onloadstart=this.onloadend=this.onload=this.onerror=this.onabort=this.onreadystatechange=null;this.url="";this.method="GET";this.readyState=this.UNSENT;this.withCredentials=!1;this.status=200;this.statusText=
"OK";this.response="";this.responseType="text";this.responseText="";this.responseXML=null;this.responseURL="";this.upload={};this.timeout=0;this._requestHeaders=new headers_polyfill_1.Headers;this._responseHeaders=new headers_polyfill_1.Headers}XMLHttpRequestOverride.prototype.setReadyState=function(nextState){nextState!==this.readyState&&(this.log("readyState change %d -\x3e %d",this.readyState,nextState),this.readyState=nextState,nextState!==this.UNSENT&&(this.log("triggering readystate change..."),
this.trigger("readystatechange")))};XMLHttpRequestOverride.prototype.trigger=function(eventName,options){var _a;this.log('trigger "%s" (%d)',eventName,this.readyState);this.log('resolve listener for event "%s"',eventName);var callback=this["on"+eventName];null===callback||void 0===callback?void 0:callback.call(this,createEvent_1.createEvent(this,eventName,options));try{for(var _b=__values(this._events),_c=_b.next();!_c.done;_c=_b.next()){var event_1=_c.value;event_1.name===eventName&&(log('calling mock event listener "%s" (%d)',
eventName,this.readyState),event_1.listener.call(this,createEvent_1.createEvent(this,eventName,options)))}}catch(e_1_1){var e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error;}}return this};XMLHttpRequestOverride.prototype.reset=function(){this.log("reset");this.setReadyState(this.UNSENT);this.status=200;this.statusText="OK";this.responseXML=this.responseText=this.response=null;this._requestHeaders=new headers_polyfill_1.Headers;this._responseHeaders=
new headers_polyfill_1.Headers};XMLHttpRequestOverride.prototype.open=function(method,url,async,user,password){void 0===async&&(async=!0);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){this.log=this.log.extend("request "+method+" "+url);this.log("open",{method,url,async,user,password});this.reset();this.setReadyState(this.OPENED);"undefined"===typeof url?(this.url=method,this.method="GET"):(this.url=url,this.method=method,this.async=async,this.user=user,this.password=
password);return[2]})})};XMLHttpRequestOverride.prototype.send=function(data){var _this=this;this.log("send %s %s",this.method,this.url);var buffer="string"===typeof data?bufferUtils_1.encodeBuffer(data):data||new ArrayBuffer(0);try{var url=new URL(this.url)}catch(error){url=new URL(this.url,window.location.href)}this.log("request headers",this._requestHeaders);var isomorphicRequest=new IsomorphicRequest_1.IsomorphicRequest(url,{body:buffer,method:this.method,headers:this._requestHeaders,credentials:this.withCredentials?
"include":"omit"}),interactiveIsomorphicRequest=new InteractiveIsomorphicRequest_1.InteractiveIsomorphicRequest(isomorphicRequest);this.log('emitting the "request" event for %d listener(s)...',emitter.listenerCount("request"));emitter.emit("request",interactiveIsomorphicRequest);this.log("awaiting mocked response...");Promise.resolve(until_1.until(function(){return __awaiter(_this,void 0,void 0,function(){var _a$jscomp$0,mockedResponse;return __generator(this,function(_b){switch(_b.label){case 0:return[4,
emitter.untilIdle("request",function(_a){return __read(_a.args,1)[0].id===interactiveIsomorphicRequest.id})];case 1:return _b.sent(),this.log("all request listeners have been resolved!"),[4,interactiveIsomorphicRequest.respondWith.invoked()];case 2:return _a$jscomp$0=__read.apply(void 0,[_b.sent(),1]),mockedResponse=_a$jscomp$0[0],this.log("event.respondWith called with:",mockedResponse),[2,mockedResponse]}})})})).then(function(_a){var _b,_c,_d=__read(_a,2);_a=_d[0];_d=_d[1];if(_a)_this.log("middleware function threw an exception!",
_a),_this.trigger("error"),_this.abort();else if(_d)_this.log("received mocked response",_d),_this.trigger("loadstart"),_this.status=null!==(_b=_d.status)&&void 0!==_b?_b:200,_this.statusText=_d.statusText||"OK",_this._responseHeaders=_d.headers?headers_polyfill_1.objectToHeaders(_d.headers):new headers_polyfill_1.Headers,_this.log("set response status",_this.status,_this.statusText),_this.log("set response headers",_this._responseHeaders),_this.setReadyState(_this.HEADERS_RECEIVED),_this.log("response type",
_this.responseType),_this.response=_this.getResponseBody(_d.body),_this.responseURL=_this.url,_this.responseText=_d.body||"",_this.responseXML=_this.getResponseXML(),_this.log("set response body",_this.response),_d.body&&_this.response&&(_this.setReadyState(_this.LOADING),_b=bufferFrom_1.bufferFrom(_d.body),_this.trigger("progress",{loaded:_b.length,total:_b.length})),_this.setReadyState(_this.DONE),_this.trigger("load"),_this.trigger("loadend"),emitter.emit("response",isomorphicRequest,toIsoResponse_1.toIsoResponse(_d));
else{_this.log("no mocked response received!");var originalRequest_1=new XMLHttpRequest;_this.log("opening an original request %s %s",_this.method,_this.url);originalRequest_1.open(_this.method,_this.url,null!==(_c=_this.async)&&void 0!==_c?_c:!0,_this.user,_this.password);originalRequest_1.addEventListener("load",function(){_this.log('original "onload"');_this.status=originalRequest_1.status;_this.statusText=originalRequest_1.statusText;_this.responseURL=originalRequest_1.responseURL;_this.responseType=
originalRequest_1.responseType;_this.response=originalRequest_1.response;_this.responseText=originalRequest_1.responseText;_this.responseXML=originalRequest_1.responseXML;_this.log("set mock request readyState to DONE");_this.setReadyState(_this.DONE);_this.log("received original response",_this.status,_this.statusText);_this.log("original response body:",_this.response);var responseHeaders=originalRequest_1.getAllResponseHeaders();_this.log("original response headers:\n",responseHeaders);_this._responseHeaders=
headers_polyfill_1.stringToHeaders(responseHeaders);_this.log("original response headers (normalized)",_this._responseHeaders);_this.log("original response finished");emitter.emit("response",isomorphicRequest,{status:originalRequest_1.status,statusText:originalRequest_1.statusText,headers:_this._responseHeaders,body:originalRequest_1.response})});_this.propagateCallbacks(originalRequest_1);_this.propagateListeners(originalRequest_1);_this.propagateHeaders(originalRequest_1,_this._requestHeaders);
_this.async&&(originalRequest_1.timeout=_this.timeout);_this.log("send",data);originalRequest_1.send(data)}})};XMLHttpRequestOverride.prototype.abort=function(){this.log("abort");this.readyState>this.UNSENT&&this.readyState<this.DONE&&(this.setReadyState(this.UNSENT),this.trigger("abort"))};XMLHttpRequestOverride.prototype.dispatchEvent=function(){return!1};XMLHttpRequestOverride.prototype.setRequestHeader=function(name,value){this.log('set request header "%s" to "%s"',name,value);this._requestHeaders.append(name,
value)};XMLHttpRequestOverride.prototype.getResponseHeader=function(name){this.log('get response header "%s"',name);if(this.readyState<this.HEADERS_RECEIVED)return this.log("cannot return a header: headers not received (state: %s)",this.readyState),null;var headerValue=this._responseHeaders.get(name);this.log('resolved response header "%s" to "%s"',name,headerValue,this._responseHeaders);return headerValue};XMLHttpRequestOverride.prototype.getAllResponseHeaders=function(){this.log("get all response headers");
return this.readyState<this.HEADERS_RECEIVED?(this.log("cannot return headers: headers not received (state: %s)",this.readyState),""):headers_polyfill_1.headersToString(this._responseHeaders)};XMLHttpRequestOverride.prototype.addEventListener=function(name,listener){this.log("addEventListener",name,listener);this._events.push({name,listener})};XMLHttpRequestOverride.prototype.removeEventListener=function(name,listener){this.log("removeEventListener",name,listener);this._events=this._events.filter(function(storedEvent){return storedEvent.name!==
name&&storedEvent.listener!==listener})};XMLHttpRequestOverride.prototype.overrideMimeType=function(){};XMLHttpRequestOverride.prototype.getResponseBody=function(body){body=null!==body&&void 0!==body?body:"";this.log("coerced response body to",body);switch(this.responseType){case "json":return this.log("resolving response body as JSON"),parseJson_1.parseJson(body);case "blob":var blobType=this.getResponseHeader("content-type")||"text/plain";this.log("resolving response body as Blob",{type:blobType});
return new Blob([body],{type:blobType});case "arraybuffer":return this.log("resolving response body as ArrayBuffer"),bufferFrom_1.bufferFrom(body);default:return body}};XMLHttpRequestOverride.prototype.getResponseXML=function(){var contentType=this.getResponseHeader("Content-Type");return"application/xml"===contentType||"text/xml"===contentType?(new xmldom_1.DOMParser).parseFromString(this.responseText,contentType):null};XMLHttpRequestOverride.prototype.propagateCallbacks=function(request){var _a;
this.log("propagating request callbacks to the original request");var callbackNames="abort onerror ontimeout onload onloadstart onloadend onprogress onreadystatechange".split(" ");try{for(var callbackNames_1=__values(callbackNames),callbackNames_1_1=callbackNames_1.next();!callbackNames_1_1.done;callbackNames_1_1=callbackNames_1.next()){var callbackName=callbackNames_1_1.value,callback=this[callbackName];callback&&(request[callbackName]=this[callbackName],this.log('propagated the "%s" callback',callbackName,
callback))}}catch(e_2_1){var e_2={error:e_2_1}}finally{try{callbackNames_1_1&&!callbackNames_1_1.done&&(_a=callbackNames_1.return)&&_a.call(callbackNames_1)}finally{if(e_2)throw e_2.error;}}request.onabort=this.abort;request.onerror=this.onerror;request.ontimeout=this.ontimeout;request.onload=this.onload;request.onloadstart=this.onloadstart;request.onloadend=this.onloadend;request.onprogress=this.onprogress;request.onreadystatechange=this.onreadystatechange};XMLHttpRequestOverride.prototype.propagateListeners=
function(request){this.log("propagating request listeners (%d) to the original request",this._events.length,this._events);this._events.forEach(function(_a){request.addEventListener(_a.name,_a.listener)})};XMLHttpRequestOverride.prototype.propagateHeaders=function(request,headers){var _this=this;this.log("propagating request headers to the original request",headers);Object.entries(headers.raw()).forEach(function(_a){var _b=__read(_a,2);_a=_b[0];_b=_b[1];_this.log('setting "%s" (%s) header on the original request',
_a,_b);request.setRequestHeader(_a,_b)})};return XMLHttpRequestOverride}(),_a$jscomp$1.UNSENT=0,_a$jscomp$1.OPENED=1,_a$jscomp$1.HEADERS_RECEIVED=2,_a$jscomp$1.LOADING=3,_a$jscomp$1.DONE=4,_a$jscomp$1}}
//# sourceMappingURL=module$node_modules$$mswjs$interceptors$lib$interceptors$XMLHttpRequest$XMLHttpRequestOverride.js.map
